<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>socketPeer</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"
        integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k"
        crossorigin="anonymous"></script>
</head>

<body>

    <button onclick="onconnect()">connect</button>
    <button onclick="onstart()">start</button>
    <input type="text" name="" id="peerid">
    <script type="text/javascript">
        let peer = null
        const config = null
        /*const config = {
            host: 'tnode.nbdomain.com',
            port: 443,
            secure: true,
            path: '/peerjs'
        }*/
        let id1, id2
        const url = "ws://127.0.0.1:31416/nbpeer" //"ws://143.198.66.116:31417/nbpeer"
        function onconnect() {
            const peerid = document.querySelector("#peerid").value
            const socket = io(url);
            socket.on("connect", () => {
                console.log("connected id:", socket.id); // x8WIv7-mJelg7on_ALbx
                socket.emit("register", {}, res => {
                    console.log("got result", res)
                    id2 = res.id
                    socket.emit("connectPeer", { id1: id1, id2: id2 }, r => {
                        console.log("connectPeer:", r)
                        socket.emit("data", "Hello")
                    })
                })
            });
            socket.on("data", async (para, ret) => {
                console.log("receive:", para)
            })
        }
        function onstart() {
            const peerid = document.querySelector("#peerid").value
            console.log("peerid:", peerid)
            const socket = io(url);
            socket.on("connect", () => {
                console.log("connected id:", socket.id); // x8WIv7-mJelg7on_ALbx
                socket.emit("register", {}, res => {
                    console.log("got result", res)
                    id1 = res.id
                })
            });
            socket.on("data", async (para, ret) => {
                console.log("data:", para)
                socket.emit("data", "world")
                ret("from kkk")
            })
        }

    </script>
</body>

</html>